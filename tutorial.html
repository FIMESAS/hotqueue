
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>HotQueue Tutorial &mdash; HotQueue 0.2.7 documentation</title>
    
    <link rel="stylesheet" href="_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.2.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="HotQueue 0.2.7 documentation" href="index.html" />
    <link rel="next" title="API Reference" href="apireference.html" />
    <link rel="prev" title="HotQueue" href="index.html" />
   
  
  <link media="only screen and (max-device-width: 480px)" href="_static/small_flask.css" type= "text/css" rel="stylesheet" />

  </head>
  <body>
  
  

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="apireference.html" title="API Reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="HotQueue"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">HotQueue 0.2.7 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="hotqueue-tutorial">
<h1>HotQueue Tutorial<a class="headerlink" href="#hotqueue-tutorial" title="Permalink to this headline">¶</a></h1>
<p>A HotQueue is a simple FIFO queue that maps to a list key in Redis. The following is a brief introduction explaining how you can use HotQueue in practice with a simple example.</p>
<div class="section" id="connecting-to-redis">
<h2>Connecting to Redis<a class="headerlink" href="#connecting-to-redis" title="Permalink to this headline">¶</a></h2>
<p>Creating a queue is as simple as creating a <a class="reference internal" href="apireference.html#hotqueue.HotQueue" title="hotqueue.HotQueue"><tt class="xref py py-class docutils literal"><span class="pre">HotQueue</span></tt></a> instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hotqueue</span> <span class="kn">import</span> <span class="n">HotQueue</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">queue</span> <span class="o">=</span> <span class="n">HotQueue</span><span class="p">(</span><span class="s">&quot;myqueue&quot;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example, the queue will be stored as a Redis list named <tt class="docutils literal"><span class="pre">hotqueue:myqueue</span></tt>, on the Redis server running at <tt class="docutils literal"><span class="pre">localhost:6379</span></tt>, in database <tt class="docutils literal"><span class="pre">0</span></tt>. The <tt class="xref py py-attr docutils literal"><span class="pre">host</span></tt>, <tt class="xref py py-attr docutils literal"><span class="pre">port</span></tt> and <tt class="xref py py-attr docutils literal"><span class="pre">db</span></tt> arguments are optional; if none are given the defaults will be used.</p>
<p>If you&#8217;re hosting Redis on a Unix socket, use the <tt class="xref py py-attr docutils literal"><span class="pre">unix_socket_path</span></tt> argument instead:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">queue</span> <span class="o">=</span> <span class="n">HotQueue</span><span class="p">(</span><span class="s">&quot;myqueue&quot;</span><span class="p">,</span> <span class="n">unix_socket_path</span><span class="o">=</span><span class="s">&quot;/tmp/redis.sock&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="putting-items-onto-the-queue">
<h2>Putting Items Onto the Queue<a class="headerlink" href="#putting-items-onto-the-queue" title="Permalink to this headline">¶</a></h2>
<p>Then you may have one (or many) Python programs pushing to the queue using <a class="reference internal" href="apireference.html#hotqueue.HotQueue.put" title="hotqueue.HotQueue.put"><tt class="xref py py-meth docutils literal"><span class="pre">hotqueue.HotQueue.put()</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>You can push more than one item onto the queue at once:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s">&quot;my message&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
<p>You can safely push <strong>any Python object</strong> that can be <a class="reference external" href="http://docs.python.org/library/pickle.html">pickled</a>. Let&#8217;s use Python&#8217;s built-in <tt class="docutils literal"><span class="pre">Decimal</span></tt> as an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;1.4&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-items-off-the-queue">
<h2>Getting Items Off the Queue<a class="headerlink" href="#getting-items-off-the-queue" title="Permalink to this headline">¶</a></h2>
<p>You can then pull items off the queue using <a class="reference internal" href="apireference.html#hotqueue.HotQueue.get" title="hotqueue.HotQueue.get"><tt class="xref py py-meth docutils literal"><span class="pre">hotqueue.HotQueue.get()</span></tt></a>. You would usually do this in another Python program, but you can do it wherever you like.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="go">6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="go">&#39;my message&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="go">7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dec</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dec</span>
<span class="go">Decimal(&#39;1.4&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dec</span> <span class="o">+</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;0.3&#39;</span><span class="p">)</span>
<span class="go">Decimal(&#39;1.7&#39;)</span>
</pre></div>
</div>
</div>
<div class="section" id="consuming-the-queue">
<h2>Consuming the Queue<a class="headerlink" href="#consuming-the-queue" title="Permalink to this headline">¶</a></h2>
<p>A better way to pull items off the queue is to use <a class="reference internal" href="apireference.html#hotqueue.HotQueue.consume" title="hotqueue.HotQueue.consume"><tt class="xref py py-meth docutils literal"><span class="pre">hotqueue.HotQueue.consume()</span></tt></a>, which returns a generator that yields whenever an item is on the queue and blocks otherwise. Here&#8217;s an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">queue</span><span class="o">.</span><span class="n">consume</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">item</span>
</pre></div>
</div>
<p>If you push to the queue using <a class="reference internal" href="apireference.html#hotqueue.HotQueue.put" title="hotqueue.HotQueue.put"><tt class="xref py py-meth docutils literal"><span class="pre">hotqueue.HotQueue.put()</span></tt></a> in another Python program, you will see this program print the message then wait indefinitely for another. Replace the <tt class="docutils literal"><span class="pre">print</span></tt> statement with something more interesting, like saving a record to a database, and you&#8217;ve created an asynchronous task.</p>
</div>
<div class="section" id="writing-a-queue-worker">
<h2>Writing a Queue Worker<a class="headerlink" href="#writing-a-queue-worker" title="Permalink to this headline">¶</a></h2>
<p>An <cite>even better</cite> way to pull items off the queue is to use the <a class="reference internal" href="apireference.html#hotqueue.HotQueue.worker" title="hotqueue.HotQueue.worker"><tt class="xref py py-meth docutils literal"><span class="pre">hotqueue.HotQueue.worker()</span></tt></a> decorator. Using this decorator is like wrapping the decorated function in a <a class="reference internal" href="apireference.html#hotqueue.HotQueue.consume" title="hotqueue.HotQueue.consume"><tt class="xref py py-meth docutils literal"><span class="pre">hotqueue.HotQueue.consume()</span></tt></a> loop. Here&#8217;s an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">hotqueue</span> <span class="kn">import</span> <span class="n">HotQueue</span>

<span class="n">queue</span> <span class="o">=</span> <span class="n">HotQueue</span><span class="p">(</span><span class="s">&quot;myqueue&quot;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="nd">@queue.worker</span>
<span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">num</span> <span class="o">*</span> <span class="n">num</span>
</pre></div>
</div>
<p>Then run the function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">square</span><span class="p">()</span>
</pre></div>
</div>
<p>It will wait indefinitely and print the square of any integers it pulls off the queue. Try pushing some integers to the queue in another Python program:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>To distribute the work, run a second instance of <tt class="docutils literal"><span class="pre">square()</span></tt>. You now have two queue workers. You can run as many workers as you like, and no two workers will ever receive the same message.</p>
<p>To run and manage your worker processes, you could use something like <a class="reference external" href="http://supervisord.org/">Supervisord</a>.</p>
</div>
<div class="section" id="custom-serialization-json-etc">
<h2>Custom Serialization (JSON, etc)<a class="headerlink" href="#custom-serialization-json-etc" title="Permalink to this headline">¶</a></h2>
<p>If you don&#8217;t want to use the <a class="reference external" href="http://docs.python.org/library/pickle.html">pickle</a> serializer, you can specify any other class or module that has the same API.</p>
<p>To serialize your data as JSON, you can use the <a class="reference external" href="http://docs.python.org/library/json.html">json</a> module. Here&#8217;s an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hotqueue</span> <span class="kn">import</span> <span class="n">HotQueue</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">queue</span> <span class="o">=</span> <span class="n">HotQueue</span><span class="p">(</span><span class="s">&quot;myqueue&quot;</span><span class="p">,</span> <span class="n">serializer</span><span class="o">=</span><span class="n">json</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&quot;Richard Henry&quot;</span><span class="p">,</span> <span class="s">&#39;eyes&#39;</span><span class="p">:</span> <span class="s">&quot;blue&quot;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="go">{&#39;name&#39;: &#39;Richard Henry&#39;, &#39;eyes&#39;: &#39;blue&#39;}</span>
</pre></div>
</div>
<p>JSON serialization is particularly useful if you will be accessing this Redis list from programming languages other than Python, or want to ensure that your queue can be read between Python versions.</p>
<p>If you can, you should use <a class="reference external" href="http://pypi.python.org/pypi/simplejson/">simplejson</a> instead of <a class="reference external" href="http://docs.python.org/library/json.html">json</a>. It&#8217;s updated more frequently, and can be significantly faster than the module that ships with the standard library. You should take a look at <a class="reference external" href="http://jsonpickle.github.com/">jsonpickle</a> if you want to serialize more complex Python data structures to JSON.</p>
<p>Feel free to write your own serializer. Here&#8217;s a dummy class to give you an idea of the API required:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">DummySerializer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Serialization class that doesn&#39;t do anything. Fill in the dumps and</span>
<span class="sd">    loads methods with your own code.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Serialize the given object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">obj</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">loads</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;De-serialize the given data back to an object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">data</span>
</pre></div>
</div>
</div>
<div class="section" id="disabling-serialization">
<h2>Disabling Serialization<a class="headerlink" href="#disabling-serialization" title="Permalink to this headline">¶</a></h2>
<p>If your messages can be converted to plain text without losing any information, then you can get some performance gains by not doing any serialization at all. This is ideal if you&#8217;re queueing strings, CSV data, and so on.</p>
<p>To disable serialization, pass <tt class="docutils literal"><span class="pre">None</span></tt> to the serializer argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">queue</span> <span class="o">=</span> <span class="n">HotQueue</span><span class="p">(</span><span class="s">&quot;myqueue&quot;</span><span class="p">,</span> <span class="n">serializer</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">&quot;my,csv,data&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="go">&quot;my,csv,data&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="monitoring">
<h2>Monitoring<a class="headerlink" href="#monitoring" title="Permalink to this headline">¶</a></h2>
<p>The following software is available for monitoring your HotQueue queue instances:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/richardhenry/hotwatch">HotWatch</a>: Command line utility for monitoring the status of HotQueue queue instances.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">HotQueue Tutorial</a><ul>
<li><a class="reference internal" href="#connecting-to-redis">Connecting to Redis</a></li>
<li><a class="reference internal" href="#putting-items-onto-the-queue">Putting Items Onto the Queue</a></li>
<li><a class="reference internal" href="#getting-items-off-the-queue">Getting Items Off the Queue</a></li>
<li><a class="reference internal" href="#consuming-the-queue">Consuming the Queue</a></li>
<li><a class="reference internal" href="#writing-a-queue-worker">Writing a Queue Worker</a></li>
<li><a class="reference internal" href="#custom-serialization-json-etc">Custom Serialization (JSON, etc)</a></li>
<li><a class="reference internal" href="#disabling-serialization">Disabling Serialization</a></li>
<li><a class="reference internal" href="#monitoring">Monitoring</a></li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">HotQueue</a></li>
      <li>Next: <a href="apireference.html" title="next chapter">API Reference</a></li>
  </ul></li>
</ul>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    &copy; Copyright 2012, Richard Henry.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  
  </body>
</html>